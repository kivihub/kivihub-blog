## 一、场景描述

开发机：远程开发环境，无法访问外网

工作机：本地操作机器，链接远程开发机进行开发

## 二、工作机启动代理服务端

> https://github.com/ginuerzh/gost

```bash
gost -L http://:8118
```

如果是MacOS，使用CronTab保活：

```cron
*/10 * * * * screen -dms proxy /opt/homebrew/bin/gost -L "http://:8118"
```

## 三、开发机配置请求代理

### 1、配置http请求代理

1）配置~/.zshrc

```bash
function Proxy() { 
        #ip=工作机地址
        ip=`sudo netstat -tpn | grep "ESTABLISHED.*sshd" |grep 「开发地址」 | awk '{ print $5}' | cut -d: -f1 |sort | uniq -c |sort -n| awk '{ print $2}' | head -n 1` 
        if [ "$1" = "on" ]; then 
                export https_proxy=$ip:8118 
                export http_proxy=$ip:8118 
                echo Proxy On $ip 
        else 
                unset https_proxy 
                unset http_proxy 
                echo Proxy Off 
        fi 
}
```

2）启用代理

```bash
source ~/.zshrc
Proxy on
```

### 2、配置SSH请求代理

1）配置 **~/.ssh/config**

```nginx
Host github.com
  ProxyCommand nc -X connect -x 工作机IP:8118 %h %p
```

2）验证github联通性

```bash
ssh -T git@github.com
```

![git ssh验证](pic/git-ssh验证.png)

若出现异常，则使用crokscrew命令替换。详见：[wrongnetcat](https://pagekite.net/wiki/Howto/SshOverPageKite/#wrongnetcat)。安装命令如下：

```bash
apt install corkscrew
```

**~/.ssh/config**改成如下

```nginx
Host github.com
    ProxyCommand corkscrew 工作机IP 8118 %h %p
```


