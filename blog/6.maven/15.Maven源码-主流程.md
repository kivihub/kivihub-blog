![image-20210917202018386](../../src/main/resources/picture/image-20210917202018386.png)

#### 1. MavenCli#main

maven使用Plexus容器（一种IOC容器）进行MOJO等管理，*apache-maven/src/bin/m2.conf*里声明了其主类org.apache.maven.cli.MavenCli：

```ini
main is org.apache.maven.cli.MavenCli from plexus.core

set maven.conf default ${maven.home}/conf

[plexus.core]
load       ${maven.conf}/logging
optionally ${maven.home}/lib/ext/*.jar
load       ${maven.home}/lib/*.jar
```



```java
public int doMain( CliRequest cliRequest )
    initialize( cliRequest );

    // 解析输入的命令
    cli( cliRequest );

    // 获取系统配置
    properties( cliRequest );
    logging( cliRequest );
    version( cliRequest );
    
    // 初始化Plexus容器
    PlexusContainer localContainer = container( cliRequest );
    commands( cliRequest );
    configure( cliRequest );
    toolchains( cliRequest );
    populateRequest( cliRequest );
    encryption( cliRequest );
    repository( cliRequest );

    // 执行
    return execute( cliRequest );      
}
```

#### 2. DefaultMaven#execute

#### 3. LifecycleStarter#execute

#### 4. SingleThreadedBuilder#build

#### 5. LifecycleModuleBuilder#buildProject

```java
// 构建执行计划
MavenExecutionPlan executionPlan = builderCommon.resolveBuildPlan( session, currentProject, taskSegment, new HashSet<Artifact>() );

// 获取执行计划中要执行的MOJO
List<MojoExecution> mojoExecutions = executionPlan.getMojoExecutions();

// 执行MOJO
mojoExecutor.execute( session, mojoExecutions, reactorContext.getProjectIndex());
```

构建执行计划时会根据输入的maven命令和Maven的phase集，计算出本次命令需要执行的所有phase及phase绑定的MOJO（关键方法：*DefaultLifecycleExecutionPlanCalculator#calculateMojoExecutions*）。

#### 6.MojoExecutor#execute

MojoExecutor接收到的mojoExecutions内容如下：

![image-20210917210301773](../../src/main/resources/picture/image-20210917210301773.png)

#### 7.DefaultBuildPluginManager#executeMojo

插件管理获取对应MOJO执行

#### 8. Mojo#execute

执行Mojo的具体逻辑



