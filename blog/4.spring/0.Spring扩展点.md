## 一、BeanDefinition加载扩展点

BeanDefinitionReader，委托BeanDefinitionRegistry注册Bean

BeanDefinitionScanner，扫描bean定义

## 二、BeanDefinition修改/注册扩展点

### 1、BeanFactoryPostProcessor

### 2、BeanDefinitionRegistryPostProcessor

扩展了上面接口，增加了bean定义注册方法。`AnnotationConfigApplicationContext`构造函数注册的ConfigurationClassPostProcessor。

### 3、调用顺序

BeanDefinitionRegistryPostProcessor.postProcessBeanDefinitionRegistry -> BeanFactoryPostProcessor#postProcessBeanFactory

**1）ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry**

解析配置类，含注解Configuration，Component，ComponentScan，Import，ImportResource，Bean。

解析逻辑在ConfigurationClassParser，解析配置类注解顺序：

* PropertySource
* ComponentScan
    * ComponentScanAnnotationParser进行解析bean定义，使用ClassPathBeanDefinitionScanner进行扫描。当发现解析出的为配置类时，递归调用ConfigurationClassParser#parse进行递归解析。
* Import
* ImportResource
* Bean

**2）ConfigurationClassPostProcessor#postProcessBeanFactory**

为配置类生成CGLib动态代理

## 三、Bean创建扩展点

BeanPostProcessor，如实现AOP

## 四、Bean初始化扩展点

xxAware